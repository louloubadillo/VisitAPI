<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="style.css">
        <title>VisitAPI</title>
</head>
<body>
    <nav>
        <a href="https://www.caritas.org.mx/"><img id="hero" src="https://www.caritas.org.mx/wp-content/uploads/2019/11/caritasmty-logo-white_dc4a69f5a9b61be4fa028ffde84f244d.png"></a>
        <div id="pages">
            <ul>
                <li><a href="adminIndex.html">Inicio</a></li>
                <li><a href="datos.html">Modificar base de datos</a></li>
                <li><a href="graficas.html">Gráficas</a></li>
            </ul>
    </nav>

    <section>
        <h1>Trabajadores</h1>
        <div id="boxes-forms">
            <div id="box-forms-large">
                <h3 style="margin-bottom: 8px;">Lista de Trabajadores</h3>
                <table id="trabajadores-tabla">
                    <thead>
                        <td>ID</td>
                        <td>Nombre</td>
                        <td>Email</td>
                        <td>Encargado</td>
                    </thead>
                </table>
                <input type="button" class="buttonShow" id="toggleVisibilityButton" value="Mostrar / Ocultar">
            </div>
            <div id="box-forms">
                <form id="form-agregar-trabajador" onsubmit='agregarTrabajador(event)'>
                    <h2>Nuevo trabajador</h2>
                    Nombre:
                    <input type="text" name="name" id="name" required>
                    <br>
                    Email:
                    <input type="email" name="email" id="email" required>
                    <br>
                    Encargado:
                    <input type="checkbox" name="encargado" id="encargado" >
                    <br>
                    <input class="button" type="submit" value="Enviar">
                </form>
            </div>
            <div id="box-forms">
                <form id="form-modificar-trabajador" onsubmit='modificarTrabajador(event)'>
                    <h2>Actualizar un trabajador</h2>
                    ID:
                    <input type="text" name="userID" id="userID" required>
                    <br>
                    Nombre:
                    <input type="text" name="name" id="name" required>
                    <br>
                    Email:
                    <input type="email" name="email" id="email" required>
                    <br>
                    Encargado:
                    <input type="checkbox" name="encargado" id="encargado" >
                    <br>
                    <input class="button" type="submit" value="Enviar">
                </form>
            </div>
            <div id="box-forms">
                <form id="form-borrar-trabajador" onsubmit='eliminarTrabajador(event)'>
                    <h2>Borrar un trabajador</h2>
                    ID:
                    <input type="text" name="userID" id="userID" required>
                    <br>
                    <p>Confirmar</p>
                    <input type="checkbox" id="" required> <br>
                    <input class="button" type="submit" value="Enviar">
                </form>
            </div>
            
        </div>
    </section>
    <hr>
    <section >
        <h1>Departamentos</h1>
        <div id="boxes-forms">
            <div id="box-forms-large">
                <h3 style="margin-bottom: 8px;">Lista de Departamentos</h3>
                <table id="departamentos-tabla">
                    <thead>
                        <td>ID</td>
                        <td>Nombre</td>
                        <td>ID Encargado</td>
                    </thead>
                </table>
                <input type="button" class="buttonShow" id="toggleVisibilityButton2" value="Mostrar / Ocultar">
            </div>
            <div id="box-forms">
                <form id="form-agregar-departamento" onsubmit='agregarDepartamento(event)'>
                    <h2>Nuevo departamento</h2>
                    Nombre:
                    <input type="text" name="name" id="name" required>
                    <br>
                    ID Encargado:
                    <input type="text" name="encargado" id="encargado" >
                    <br>
                    <input class="button" type="submit" value="Enviar">
                </form>
            </div>
            <div id="box-forms">
                <form id="form-modificar-departamento" onsubmit='modificarDepartamento(event)'>
                    <h2>Actualizar un departamento</h2>
                    ID:
                    <input type="text" name="userID" id="userID" required>
                    <br>
                    Nombre:
                    <input type="text" name="name" id="name" required>
                    <br>
                    ID Encargado:
                    <input type="text" name="encargado" id="encargado" >
                    <br>
                    <input class="button" type="submit" value="Enviar">
                </form>
            </div>
            <div id="box-forms">
                <form id="form-borrar-departamento" onsubmit='eliminarDepartamento(event)'>
                    <h2>Borrar un departamento</h2>
                    ID:
                    <input type="text" name="userID" id="userID" required>
                    <br>
                    <p>Confirmar</p>
                    <input type="checkbox" id="" required> <br>
                    <input class="button" type="submit" value="Enviar">
                </form>
            </div>
            
        </div>
    </section>
    <hr>
    <section>
        <h1>Visitas</h1>
        <div id="boxes-forms">
            <div id="box-forms-large">
                <h3 style="margin-bottom: 8px;">Lista de Visitas</h3>
                <table id="visitas-tabla">
                    <thead>
                        <td>ID</td>
                        <td>ID Departamento</td>
                        <td>Fecha</td>
                    </thead>
                </table>
                <input type="button" class="buttonShow" id="toggleVisibilityButton3" value="Mostrar / Ocultar">
            </div>
            <div id="box-forms">
                <form id="form-agregar-visita" onsubmit='agregarVisita(event)'>
                    <h2>Nueva visita</h2>
                    ID Departamento
                    <input type="text" name="departamento" id="departamento" required>
                    <br>
                    Fecha
                    <input type="datetime-local" name="fecha" id="fecha" required>
                    <br>
                    <input class="button" type="submit" value="Enviar">
                </form>
            </div>
            <div id="box-forms">
                <form id="form-modificar-visita" onsubmit='modificarVisita(event)'>
                    <h2>Actualizar una visita</h2>
                    ID:
                    <input type="text" name="userID" id="userID" required>
                    <br>
                    ID Departamento
                    <input type="text" name="departamento" id="departamento" required>
                    <br>
                    Fecha
                    <input type="datetime-local" name="fecha" id="fecha" required>
                    <br>
                    <input class="button" type="submit" value="Enviar">
                </form>
            </div>
            <div id="box-forms">
                <form id="form-borrar-visita" onsubmit='eliminarVisita(event)'>
                    <h2>Borrar una visita</h2>
                    ID:
                    <input type="text" name="userID" id="userID" required>
                    <br>
                    <p>Confirmar</p>
                    <input type="checkbox" id="" required> <br>
                    <input class="button" type="submit" value="Enviar">
                </form>
            </div>
            
        </div>
    </section>
    <footer> <p>Hecho con ♡ por el equipo de Visitapp</p></footer>
    <script>        
        document.getElementById("trabajadores-tabla").style.display = "none"
        document.getElementById("departamentos-tabla").style.display = "none"
        document.getElementById("visitas-tabla").style.display = "none"

        //Sección trabajadores   
        function obtenerTrabajadores(){
            let tabla = document.querySelector('#trabajadores-tabla');
            // Vaciar tabla
            tabla.innerHTML = `<thead>
                            <td><strong>ID</strong></td>
                            <td><strong>Nombre</strong></td>
                            <td><strong>Email</strong></td>
                            <td><strong>Encargado</strong></td>
                        </thead>`
            // Obtener datos de /trabajadores
            fetch('/trabajadores')
            .then(data=>data.json()).then(data=>{
                for (let i = 0; i < data.length; i++) {
                    let id = data[i].id_trabajador;
                    let nombre = data[i].nombre;
                    let email = data[i].email;
                    let encargado = data[i].esEncargado;
                    // Crear una nueva fila
                    let fila = document.createElement('tr');
                    // Crear una nueva celda
                    let userID_td = document.createElement('td');
                    userID_td.innerHTML = id;
                    let nombre_td = document.createElement('td');
                    nombre_td.innerHTML = nombre;
                    let email_td = document.createElement('td');
                    email_td.innerHTML = email;
                    let encargado_td = document.createElement('td');
                    if(encargado){
                        encargado_td.innerHTML = 'Sí';
                    }else{
                        encargado_td.innerHTML = 'No';
                    }
                    // Agregar celdas a fila
                    fila.append(userID_td, nombre_td, email_td, encargado_td);
                    tabla.append(fila)
                }
            })
        }
        obtenerTrabajadores();

        document.getElementById("toggleVisibilityButton").addEventListener("click", function(button) {    
        if (document.getElementById("trabajadores-tabla").style.display === "none") {
            document.getElementById("trabajadores-tabla").style.display = "";
        } else {
            document.getElementById("trabajadores-tabla").style.display = "none";
        }
        });
        
        function agregarTrabajador(e){
            e.preventDefault();
            // Seleccionar forma y datos
            let form = document.querySelector('#form-agregar-trabajador');
            let nombre = form.querySelector('#name').value;
            let email = form.querySelector('#email').value;
            let esEncargado = 0; 
            if(form.querySelector('#encargado').checked){
                esEncargado = 1;
            }
            // Realizar consulta con fetch
            fetch('/agregar-trabajador', {
                method: 'POST', 
                headers: {
                    'Accept': 'application/json, text/plain, */*',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({nombre,email,esEncargado})
            }).then(data=>data.text()).then(data=>{
                alert(data);
                // Refreshear tabla de usuarios
                obtenerTrabajadores()
            })
        }

        function modificarTrabajador(e){
            e.preventDefault();
            // Seleccionar forma y datos
            let form = document.querySelector('#form-modificar-trabajador');
            let id_trabajador = form.querySelector('#userID').value;
            let nombre = form.querySelector('#name').value;
            let email = form.querySelector('#email').value;
            let esEncargado = form.querySelector('#encargado').value;
            // Realizar consulta con fetch
            fetch('/modificar-trabajador', {
                method: 'POST', 
                headers: {
                    'Accept': 'application/json, text/plain, */*',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({id_trabajador,nombre,email,esEncargado})
            }).then(data=>data.text()).then(data=>{
                alert(data);
                // Refreshear tabla de usuarios
                obtenerTrabajadores()
            })
        }

        function eliminarTrabajador(e){
            e.preventDefault();
            // Seleccionar forma y datos
            let form = document.querySelector('#form-borrar-trabajador');
            let id_trabajador= form.querySelector('#userID').value;
            // Realizar consulta con fetch
            fetch('/borrar-trabajador', {
                method: 'POST', 
                headers: {
                    'Accept': 'application/json, text/plain, */*',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({id_trabajador})
            }).then(data=>data.text()).then(data=>{
                alert(data);
                // Refreshear tabla de usuarios
                obtenerTrabajadores()
            })
        }

        //Sección departamentos
        function obtenerDepartamentos(){
            let tabla = document.querySelector('#departamentos-tabla');
            // Vaciar tabla
            tabla.innerHTML = `<thead>
                            <td><strong>ID</strong></td>
                            <td><strong>Nombre</strong></td>
                            <td><strong>ID Encargado</strong></td>
                        </thead>`
            // Obtener datos de /trabajadores
            fetch('/departamentos')
            .then(data=>data.json()).then(data=>{
                for (let i = 0; i < data.length; i++) {
                    let id = data[i].id_departamento;
                    let nombre = data[i].nombre;
                    let encargado = data[i].id_encargado;
                    // Crear una nueva fila
                    let fila = document.createElement('tr');
                    // Crear una nueva celda
                    let userID_td = document.createElement('td');
                    userID_td.innerHTML = id;
                    let nombre_td = document.createElement('td');
                    nombre_td.innerHTML = nombre;
                    let encargado_td = document.createElement('td');
                    encargado_td.innerHTML = encargado;
                    // Agregar celdas a fila
                    fila.append(userID_td, nombre_td,encargado_td);
                    tabla.append(fila)
                }
            })
        }
        obtenerDepartamentos();

        document.getElementById("toggleVisibilityButton2").addEventListener("click", function(button) {    
        if (document.getElementById("departamentos-tabla").style.display === "none") {
            document.getElementById("departamentos-tabla").style.display = "";
        } else {
            document.getElementById("departamentos-tabla").style.display = "none";
        }
        });
        
        function agregarDepartamento(e){
            e.preventDefault();
            // Seleccionar forma y datos
            let form = document.querySelector('#form-agregar-departamento');
            let nombre = form.querySelector('#name').value;
            let id_encargado = form.querySelector('#encargado').value;
            // Realizar consulta con fetch
            fetch('/agregar-departamento', {
                method: 'POST', 
                headers: {
                    'Accept': 'application/json, text/plain, */*',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({nombre, id_encargado})
            }).then(data=>data.text()).then(data=>{
                alert(data);
                // Refreshear tabla de usuarios
                obtenerDepartamentos()
            })
        }

        function modificarDepartamento(e){
            e.preventDefault();
            // Seleccionar forma y datos
            let form = document.querySelector('#form-modificar-departamento');
            let id_departamento = form.querySelector('#userID').value;
            let nombre = form.querySelector('#name').value;
            let id_encargado = form.querySelector('#encargado').value;
            // Realizar consulta con fetch
            fetch('/modificar-departamento', {
                method: 'POST', 
                headers: {
                    'Accept': 'application/json, text/plain, */*',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({id_departamento,nombre,id_encargado})
            }).then(data=>data.text()).then(data=>{
                alert(data);
                // Refreshear tabla de usuarios
                obtenerDepartamentos()
            })
        }

        function eliminarDepartamento(e){
            e.preventDefault();
            // Seleccionar forma y datos
            let form = document.querySelector('#form-borrar-departamento');
            let id_departamento= form.querySelector('#userID').value;
            // Realizar consulta con fetch
            fetch('/borrar-departamento', {
                method: 'POST', 
                headers: {
                    'Accept': 'application/json, text/plain, */*',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({id_departamento})
            }).then(data=>data.text()).then(data=>{
                alert(data);
                // Refreshear tabla de usuarios
                obtenerDepartamentos()
            })
        }

        //Sección visitas
        function obtenerVisitas(){
            let tabla = document.querySelector('#visitas-tabla');
            // Vaciar tabla
            tabla.innerHTML = `<thead>
                            <td><strong>ID</strong></td>
                            <td><strong>ID Departamento</strong></td>
                            <td><strong>Fecha</strong></td>
                        </thead>`
            // Obtener datos de /visitas
            fetch('/visitas')
            .then(data=>data.json()).then(data=>{
                for (let i = 0; i < data.length; i++) {
                    let id = data[i].id_visita;
                    let departamento = data[i].departamento;
                    let fecha = data[i].fecha;
                    //format date
                    let date = new Date(fecha);
                    //format date in dd/mm/yyyy hh:mm
                    let formattedDate = date.getDate() + "/" + (date.getMonth() + 1) + "/" + date.getFullYear() + " " + date.getHours() + ":" + date.getMinutes();
                    // Crear una nueva fila
                    let fila = document.createElement('tr');
                    // Crear una nueva celda
                    let id_td = document.createElement('td');
                    id_td.innerHTML = id;
                    let departamento_td = document.createElement('td');  
                    departamento_td.innerHTML = departamento;
                    let fecha_td = document.createElement('td');
                    fecha_td.innerHTML = formattedDate;
                    
                    // Agregar celdas a fila
                    fila.append(id_td, departamento_td, fecha_td);
                    tabla.append(fila)
                }
            })
        }
        obtenerVisitas();
        document.getElementById("toggleVisibilityButton3").addEventListener("click", function(button) {    
        if (document.getElementById("visitas-tabla").style.display === "none") {
            document.getElementById("visitas-tabla").style.display = "";
        } else {
            document.getElementById("visitas-tabla").style.display = "none";
        }
        });

        function agregarVisita(e){
            e.preventDefault();
            // Seleccionar forma y datos
            let form = document.querySelector('#form-agregar-visita');
            let departamento = form.querySelector('#departamento').value;
            let fecha = form.querySelector('#fecha').value;
            // Realizar consulta con fetch
            fetch('/agregar-visita', {
                method: 'POST', 
                headers: {
                    'Accept': 'application/json, text/plain, */*',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({departamento,fecha})
            }).then(data=>data.text()).then(data=>{
                alert(data);
                // Refreshear tabla de usuarios
                obtenerVisitas()
            })
        }

        function modificarVisita(e){
            e.preventDefault();
            // Seleccionar forma y datos
            let form = document.querySelector('#form-modificar-visita');
            let id_visita = form.querySelector('#userID').value;
            let departamento = form.querySelector('#departamento').value;
            let fecha = form.querySelector('#fecha').value;
            // Realizar consulta con fetch
            fetch('/modificar-visita', {
                method: 'POST', 
                headers: {
                    'Accept': 'application/json, text/plain, */*',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({id_visita,departamento,fecha})
            }).then(data=>data.text()).then(data=>{
                alert(data);
                // Refreshear tabla de usuarios
                obtenerVisitas()
            })
        }

        function eliminarVisita(e){
            e.preventDefault();
            // Seleccionar forma y datos
            let form = document.querySelector('#form-borrar-visita');
            let id_visita= form.querySelector('#userID').value;
            // Realizar consulta con fetch
            fetch('/borrar-visita', {
                method: 'POST', 
                headers: {
                    'Accept': 'application/json, text/plain, */*',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({id_visita})
            }).then(data=>data.text()).then(data=>{
                alert(data);
                // Refreshear tabla de usuarios
                obtenerVisitas()
            })
        }

    </script>
</body>
</html>